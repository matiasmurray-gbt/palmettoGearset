@isTest
private  class CommissionTrackerTest 
{
    private static testmethod void commissionToBeProcessedTest()
    {
        string account_recordtype_id = Schema.SObjectType.Account.getRecordTypeInfosByName().get('Residential - Customer').getRecordTypeId();
        Account acc = TestDataFactory.createAccount('Harbor Energy',account_recordtype_id);
        acc.Channel_Partner_Status__c = 'Active';
        insert acc;
        Contact cont = TestDataFactory.createContact('Test','O1', acc.id);
        cont.Title = 'Leadership';
        insert cont;
        List<Opportunity> opp_list = new List<Opportunity>();
        string opp_recordtype_id = Schema.SObjectType.Opportunity.getRecordTypeInfosByName().get('3rd Party - Design Sales').getRecordTypeId();
        Opportunity opp_1 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 1', acc.id, '17. Install Ready', 'Alabama');
        opp_1.LeadSource = '3rd Party Provider';
        opp_1.Lead_Source_Type__c = 'Channel';
        opp_1.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_1.Financing_Tool__c = 'Sunlight';
        opp_1.Loan_Term__c = '20';
        opp_1.Proposal_Created__c = true;
        opp_1.Engineering_Created__c = true;
        opp_1.Final_Design_Created_Date__c = system.Date.today();
        opp_1.Number_of_Arrays__c = 1;
        opp_1.Contract_Received_Confirmed__c= true;
        opp_1.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_1.Amount = 30000;
        opp_1.Number_of_Solar_Panels__c  = 25;
        opp_1.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_1.Panel_Wattage__c = 300;
        opp_1.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_1);
        /* -------------------------------------------------------*/
        Opportunity opp_2 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 2', acc.id, '7a. Contract Received Confirmed', 'Alabama');
        opp_2.LeadSource = '3rd Party Provider';
        opp_2.Lead_Source_Type__c = 'Channel';
        opp_2.Financing_Tool__c = 'Sunlight';
        opp_2.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_2.Loan_Term__c = '20';
        opp_2.Proposal_Created__c = true;
        opp_2.Engineering_Created__c = true;
        opp_2.Final_Design_Created_Date__c = system.Date.today();
        opp_2.Number_of_Arrays__c = 1;
        opp_2.Contract_Received_Confirmed__c= true;
        opp_2.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_2.Amount = 30000;
        opp_2.Number_of_Solar_Panels__c  = 25;
        opp_2.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_2.Panel_Wattage__c = 300;
        opp_2.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_2);
        /*--------------------------------------- */
        Opportunity opp_3 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 3', acc.id, '22. PTO', 'Alabama');
        opp_3.LeadSource = '3rd Party Provider';
        opp_3.Lead_Source_Type__c = 'Channel';
        opp_3.Financing_Tool__c = 'Sunlight';
        opp_3.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_2.Loan_Term__c = '20';
        opp_3.Proposal_Created__c = true;
        opp_3.Engineering_Created__c = true;
        opp_3.Final_Design_Created_Date__c = system.Date.today();
        opp_3.Number_of_Arrays__c = 1;
        opp_3.Contract_Received_Confirmed__c= true;
        opp_3.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_3.Amount = 30000;
        opp_3.Number_of_Solar_Panels__c  = 25;
        opp_3.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_3.Panel_Wattage__c = 300;
        opp_3.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_3);
        /*--------------------------------------------------*/
        Opportunity opp_4 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 3', acc.id, 'Cancelled', 'Alabama');
        opp_4.Reason_for_loss__c = 'Cancelled with Finance Partner';
        opp_4.LeadSource = '3rd Party Provider';
        opp_4.Lead_Source_Type__c = 'Channel';
        opp_4.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_4.Financing_Tool__c = 'Sunlight';
        opp_4.Loan_Term__c = '20';
        opp_4.Proposal_Created__c = true;
        opp_4.Engineering_Created__c = true;
        opp_4.Final_Design_Created_Date__c = system.Date.today();
        opp_4.Number_of_Arrays__c = 1;
        opp_4.Contract_Received_Confirmed__c= true;
        opp_4.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_4.Amount = 30000;
        opp_4.Number_of_Solar_Panels__c  = 25;
        opp_4.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_4.Panel_Wattage__c = 300;
        opp_4.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_4);
        /*--------------------------------------------*/
        Opportunity opp_5 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 1', acc.id, '17. Install Ready', 'Alabama');
        opp_5.LeadSource = '3rd Party Provider';
        opp_5.Lead_Source_Type__c = 'Channel';
        opp_5.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_5.Financing_Tool__c = 'Sunlight';
        opp_5.Loan_Term__c = '20';
        opp_5.Proposal_Created__c = true;
        opp_5.Engineering_Created__c = true;
        opp_5.Final_Design_Created_Date__c = system.Date.today();
        opp_5.Number_of_Arrays__c = 1;
        opp_5.Contract_Received_Confirmed__c= true;
        opp_5.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_5.Amount = 30000;
        opp_5.Number_of_Solar_Panels__c  = 25;
        opp_5.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_5.Panel_Wattage__c = 300;
        opp_5.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_5);
        /*--------------------------------------------------------------*/
        Opportunity opp_6 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 1', acc.id, '17. Install Ready', 'Alabama');
        opp_6.LeadSource = '3rd Party Provider';
        opp_6.Lead_Source_Type__c = 'Channel';
        opp_6.X3rd_Party_Partner__c = '360 Total Solutions LLC';
        opp_6.Financing_Tool__c = 'Sunlight';
        opp_6.Loan_Term__c = '20';
        opp_6.Proposal_Created__c = true;
        opp_6.Engineering_Created__c = true;
        opp_6.Final_Design_Created_Date__c = system.Date.today();
        opp_6.Number_of_Arrays__c = 1;
        opp_6.Contract_Received_Confirmed__c= true;
        opp_6.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_6.Amount = 30000;
        opp_6.Number_of_Solar_Panels__c  = 25;
        opp_6.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_6.Panel_Wattage__c = 300;
        opp_6.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_6);
        insert opp_list;
        opp_1.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-6);
        update opp_1;
        opp_5.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-6);
        update opp_5;
        opp_6.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-6);
        update opp_6;
        /*----------------------------------------------------*/
        
        Commission_plan__c commission_plan_1 = TestDataFactory.createCommissionPlan('CP Alabama');
        commission_plan_1.Location__c = 'Alabama';
        commission_plan_1.User__c = UserInfo.getUserId();
        commission_plan_1.Channel_Partner_Account__c = acc.id;
        commission_plan_1.X3rd_Party_Partner__c = 'Harbor Energy';
        commission_plan_1.Base_6kW__c = 2500;
        commission_plan_1.X6kW__c = 2500;
        commission_plan_1.Milestone_1_Percent__c = 30;
        commission_plan_1.Milestone_2_Percent__c = 55;
        commission_plan_1.Milestone_3_Percent__c = 15;
        insert commission_plan_1;
        Commission__c commission_1 = new Commission__c();
        commission_1.Opportunity__c = opp_1.id;
        commission_1.Commission_Plan__c = commission_plan_1.id;
       
        insert commission_1;
        /*------------------------------------------ */
        Commission__c commission_2 = new Commission__c();
        commission_2.Opportunity__c = opp_2.id;
        commission_2.Commission_Plan__c = commission_plan_1.id;
        insert commission_2;
        /*------------------------------------------ */
        Commission__c commission_3 = new Commission__c();
        commission_3.Opportunity__c = opp_3.id;
        commission_3.Commission_Plan__c = commission_plan_1.id;
        
        insert commission_3;
        /*------------------------------------------ */
        Commission__c commission_4 = new Commission__c();
        commission_4.Opportunity__c = opp_4.id;
        commission_4.Commission_Plan__c = commission_plan_1.id;
        insert commission_4;
        /*------------------------------------------ */
        Commission__c commission_5 = new Commission__c();
        commission_5.Opportunity__c = opp_5.id;
        commission_5.Commission_Plan__c = commission_plan_1.id;
        insert commission_5;
        /*------------------------------------------ */
        Commission__c commission_6 = new Commission__c();
        commission_6.Opportunity__c = opp_6.id;
        commission_6.Commission_Plan__c = commission_plan_1.id;
        insert commission_6;
        test.startTest();
        CommissionTrackerController tracker = new CommissionTrackerController();
        List<SelectOption> options = tracker.commissionPickListOptions;
        tracker.commissionToBeProcessedOnSearch();
        string soql = CommissionTrackerUtility.commissionToBeProcessedSOQL('M1', '\'Harbor Energy\'', system.date.today(), system.date.today());
        soql = CommissionTrackerUtility.commissionToBeProcessedSOQL('M2', '\'Harbor Energy\'', system.date.today(), system.date.today());
        soql = CommissionTrackerUtility.commissionToBeProcessedSOQL('M3', '\'Harbor Energy\'', system.date.today(), system.date.today());
        soql = CommissionTrackerUtility.commissionToBeProcessedSOQL('Clawbacks', '\'Harbor Energy\'', system.date.today(), system.date.today());
        soql = CommissionTrackerUtility.commissionToBeProcessedSOQL('', '\'Harbor Energy\'', system.date.today(), system.date.today());
        tracker.commissionTrackerExport();
        tracker.findPartyProvider();
        tracker.closeEmailPopup();
        tracker.showEmailPopup();
        tracker.isCommissionToBeProcessed = false;
        tracker.showEmailPopup();
        tracker.selectAllForCommissionToBeProcessed = false;
        tracker.selectCommissionToBeProcessedRecords();
        tracker.selectAllForCommissionToBeProcessed = true;
        tracker.selectCommissionToBeProcessedRecords(); 
        tracker.processMilestone();
        tracker.openUpprocessPopup();
        tracker.closeSummaryView();
        tracker.showSummaryCommissions();
        tracker.unprocessCommission();
        test.stopTest();
    }
    
    private static testmethod void processedAndPaidCommissionsTest()
    {
        string account_recordtype_id = Schema.SObjectType.Account.getRecordTypeInfosByName().get('Residential - Customer').getRecordTypeId();
        Account acc = TestDataFactory.createAccount('Harbor Energy',account_recordtype_id);
        acc.Channel_Partner_Status__c = 'Active';
        insert acc;
        Account acc2 = TestDataFactory.createAccount('360 Total Solutions LLC',account_recordtype_id);
        acc2.Channel_Partner_Status__c = 'Active';
        insert acc2;
        Contact cont = TestDataFactory.createContact('Test','O1', acc.id);
        cont.Title = 'Leadership';
        cont.email = 'test1@gmai.com';
        insert cont;
        Contact con2 = TestDataFactory.createContact('Test','O2', acc.id);
        con2.Title = 'Leadership';
        con2.email = 'test2@gmai.com';
        insert con2;
        Contact cont3 = TestDataFactory.createContact('Test','O3', acc2.id);
        cont3.Title = 'Leadership';
        cont3.email = 'test3@gmai.com';
        insert cont3;
        Contact con4 = TestDataFactory.createContact('Test','O4', acc2.id);
        con4.Title = 'Leadership';
        con4.email = 'test4@gmai.com';
        insert con4;
        List<Opportunity> opp_list = new List<Opportunity>();
        string opp_recordtype_id = Schema.SObjectType.Opportunity.getRecordTypeInfosByName().get('3rd Party - Design Sales').getRecordTypeId();
        Opportunity opp_1 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 1', acc.id, '17. Install Ready', 'Alabama');
        opp_1.LeadSource = '3rd Party Provider';
        opp_1.Lead_Source_Type__c = 'Channel';
        opp_1.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_1.Financing_Tool__c = 'Sunlight';
        opp_1.Loan_Term__c = '20';
        opp_1.Proposal_Created__c = true;
        opp_1.Engineering_Created__c = true;
        opp_1.Final_Design_Created_Date__c = system.Date.today();
        opp_1.Number_of_Arrays__c = 1;
        opp_1.Contract_Received_Confirmed__c= true;
        opp_1.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_1.Amount = 30000;
        opp_1.Number_of_Solar_Panels__c  = 25;
        opp_1.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_1.Panel_Wattage__c = 300;
        opp_1.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_1);
        /* -------------------------------------------------------*/
        Opportunity opp_2 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 2', acc.id, '7a. Contract Received Confirmed', 'Alabama');
        opp_2.LeadSource = '3rd Party Provider';
        opp_2.Lead_Source_Type__c = 'Channel';
        opp_2.Financing_Tool__c = 'Sunlight';
        opp_2.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_2.Loan_Term__c = '20';
        opp_2.Proposal_Created__c = true;
        opp_2.Engineering_Created__c = true;
        opp_2.Final_Design_Created_Date__c = system.Date.today();
        opp_2.Number_of_Arrays__c = 1;
        opp_2.Contract_Received_Confirmed__c= true;
        opp_2.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_2.Amount = 30000;
        opp_2.Number_of_Solar_Panels__c  = 25;
        opp_2.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_2.Panel_Wattage__c = 300;
        opp_2.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_2);
        /*--------------------------------------- */
        Opportunity opp_3 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 3', acc.id, '22. PTO', 'Alabama');
        opp_3.LeadSource = '3rd Party Provider';
        opp_3.Lead_Source_Type__c = 'Channel';
        opp_3.Financing_Tool__c = 'Sunlight';
        opp_3.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_2.Loan_Term__c = '20';
        opp_3.Proposal_Created__c = true;
        opp_3.Engineering_Created__c = true;
        opp_3.Final_Design_Created_Date__c = system.Date.today();
        opp_3.Number_of_Arrays__c = 1;
        opp_3.Contract_Received_Confirmed__c= true;
        opp_3.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_3.Amount = 30000;
        opp_3.Number_of_Solar_Panels__c  = 25;
        opp_3.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_3.Panel_Wattage__c = 300;
        opp_3.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_3);
        /*--------------------------------------------------*/
        Opportunity opp_4 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 3', acc.id, 'Cancelled', 'Alabama');
        opp_4.Reason_for_loss__c = 'Cancelled with Finance Partner';
        opp_4.LeadSource = '3rd Party Provider';
        opp_4.Lead_Source_Type__c = 'Channel';
        opp_4.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_4.Financing_Tool__c = 'Sunlight';
        opp_4.Loan_Term__c = '20';
        opp_4.Proposal_Created__c = true;
        opp_4.Engineering_Created__c = true;
        opp_4.Final_Design_Created_Date__c = system.Date.today();
        opp_4.Number_of_Arrays__c = 1;
        opp_4.Contract_Received_Confirmed__c= true;
        opp_4.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_4.Amount = 30000;
        opp_4.Number_of_Solar_Panels__c  = 25;
        opp_4.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_4.Panel_Wattage__c = 300;
        opp_4.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_4);
        /*--------------------------------------------*/
        Opportunity opp_5 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 1', acc.id, '17. Install Ready', 'Alabama');
        opp_5.LeadSource = '3rd Party Provider';
        opp_5.Lead_Source_Type__c = 'Channel';
        opp_5.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_5.Financing_Tool__c = 'Sunlight';
        opp_5.Loan_Term__c = '20';
        opp_5.Proposal_Created__c = true;
        opp_5.Engineering_Created__c = true;
        opp_5.Final_Design_Created_Date__c = system.Date.today();
        opp_5.Number_of_Arrays__c = 1;
        opp_5.Contract_Received_Confirmed__c= true;
        opp_5.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_5.Amount = 30000;
        opp_5.Number_of_Solar_Panels__c  = 25;
        opp_5.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_5.Panel_Wattage__c = 300;
        opp_5.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_5);
        /*--------------------------------------------------------------*/
        Opportunity opp_6 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 1', acc.id, '17. Install Ready', 'Alabama');
        opp_6.LeadSource = '3rd Party Provider';
        opp_6.Lead_Source_Type__c = 'Channel';
        opp_6.X3rd_Party_Partner__c = '360 Total Solutions LLC';
        opp_6.Financing_Tool__c = 'Sunlight';
        opp_6.Loan_Term__c = '20';
        opp_6.Proposal_Created__c = true;
        opp_6.Engineering_Created__c = true;
        opp_6.Final_Design_Created_Date__c = system.Date.today();
        opp_6.Number_of_Arrays__c = 1;
        opp_6.Contract_Received_Confirmed__c= true;
        opp_6.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_6.Amount = 30000;
        opp_6.Number_of_Solar_Panels__c  = 25;
        opp_6.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_6.Panel_Wattage__c = 300;
        opp_6.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_6);
        /*--------------------------------------------------------------*/
        Opportunity opp_7 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 1', acc.id, '17. Install Ready', 'Alabama');
        opp_7.LeadSource = '3rd Party Provider';
        opp_7.Lead_Source_Type__c = 'Channel';
        opp_7.X3rd_Party_Partner__c = '360 Total Solutions LLC';
        opp_7.Financing_Tool__c = 'Sunlight';
        opp_7.Loan_Term__c = '20';
        opp_7.Proposal_Created__c = true;
        opp_7.Engineering_Created__c = true;
        opp_7.Final_Design_Created_Date__c = system.Date.today();
        opp_7.Number_of_Arrays__c = 1;
        opp_7.Contract_Received_Confirmed__c= true;
        opp_7.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_7.Amount = 30000;
        opp_7.Number_of_Solar_Panels__c  = 25;
        opp_7.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_7.Panel_Wattage__c = 300;
        opp_7.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_7);
        insert opp_list;
        /*----------------------------------------------------*/
        
        Commission_plan__c commission_plan_1 = TestDataFactory.createCommissionPlan('CP Alabama');
        commission_plan_1.Location__c = 'Alabama';
        commission_plan_1.User__c = UserInfo.getUserId();
        commission_plan_1.Channel_Partner_Account__c = acc.id;
        commission_plan_1.X3rd_Party_Partner__c = 'Harbor Energy';
        commission_plan_1.Base_6kW__c = 2500;
        commission_plan_1.X6kW__c = 2500;
        commission_plan_1.Milestone_1_Percent__c = 30;
        commission_plan_1.Milestone_2_Percent__c = 55;
        commission_plan_1.Milestone_3_Percent__c = 15;
        insert commission_plan_1;
        Commission__c commission_1 = new Commission__c();
        commission_1.Opportunity__c = opp_1.id;
        commission_1.Commission_Plan__c = commission_plan_1.id;
        commission_1.Milestone_1_Processed_Date__c = system.date.Today();
        commission_1.Milestone_1_Processed__c = true;
        insert commission_1;
        /*------------------------------------------ */
        Commission__c commission_2 = new Commission__c();
        commission_2.Opportunity__c = opp_2.id;
        commission_2.Commission_Plan__c = commission_plan_1.id;
        commission_2.Milestone_1_Processed_Date__c = system.date.Today();
        commission_2.Milestone_1_Processed__c = true;
        insert commission_2;
        /*------------------------------------------ */
        Commission__c commission_3 = new Commission__c();
        commission_3.Opportunity__c = opp_3.id;
        commission_3.Milestone_2_Processed_Date__c = system.date.Today();
        commission_3.Milestone_2_Processed__c = true;
        commission_3.Commission_Plan__c = commission_plan_1.id;
        insert commission_3;
        /*------------------------------------------ */
        Commission__c commission_4 = new Commission__c();
        commission_4.Opportunity__c = opp_4.id;
        commission_4.Commission_Plan__c = commission_plan_1.id;
        commission_4.Milestone_3_Processed_Date__c = system.date.Today();
        commission_4.Milestone_3_Processed__c = true;
        insert commission_4;
        /*------------------------------------------ */
        Commission__c commission_5 = new Commission__c();
        commission_5.Opportunity__c = opp_5.id;
        commission_5.Commission_Plan__c = commission_plan_1.id;
        commission_5.M1_Clawback_Processed_Date__c = system.date.Today();
        commission_5.M1_Clawback_Complete__c = true;
        insert commission_5;
        /*------------------------------------------ */
        Commission__c commission_6 = new Commission__c();
        commission_6.Opportunity__c = opp_6.id;
        commission_6.Commission_Plan__c = commission_plan_1.id;
        commission_6.Milestone_1_Processed_Date__c = system.date.Today();
        commission_6.Milestone_1_Processed__c = true;
        insert commission_6;
        /*------------------------------------------ */
        Commission__c commission_7 = new Commission__c();
        commission_7.Opportunity__c = opp_3.id;
        commission_7.Commission_Plan__c = commission_plan_1.id;
        commission_7.Milestone_2_Processed_Date__c = system.date.Today();
        commission_7.Milestone_2_Processed__c = true;
        insert commission_7;
        /*------------------------------------------ */
        Commission__c commission_8 = new Commission__c();
        commission_8.Opportunity__c = opp_7.id;
        commission_8.Milestone_2_Processed_Date__c = system.date.Today();
        commission_8.Milestone_2_Processed__c = true;
        insert commission_8;
        /*------------------------------------------ */
        Commission__c commission_9 = new Commission__c();
        commission_9.Opportunity__c = opp_3.id;
        commission_9.Commission_Plan__c = commission_plan_1.id;
        commission_9.Milestone_3_Processed_Date__c = system.date.Today();
        commission_9.Milestone_3_Processed__c = true;
        insert commission_9;
         /*------------------------------------------ */
        Commission__c commission_10 = new Commission__c();
        commission_10.Opportunity__c = opp_7.id;
        commission_10.Milestone_3_Processed_Date__c = system.date.Today();
        commission_10.Milestone_3_Processed__c = true;
        insert commission_10;
        /*------------------------------------------ */
        Commission__c commission_11 = new Commission__c();
        commission_11.Opportunity__c = opp_3.id;
        commission_11.Commission_Plan__c = commission_plan_1.id;
        commission_11.M1_Clawback_Processed_Date__c = system.date.Today();
        commission_11.M1_Clawback_Complete__c = true;
        insert commission_11;
         /*------------------------------------------ */
        Commission__c commission_12 = new Commission__c();
        commission_12.Opportunity__c = opp_7.id;
        commission_12.M1_Clawback_Processed_Date__c = system.date.Today();
        commission_12.M1_Clawback_Complete__c = true;
        insert commission_12;
        test.startTest();
        CommissionTrackerController tracker = new CommissionTrackerController();
        List<SelectOption> options = tracker.commissionPickListOptions;
        tracker.fromDate = system.date.today();
        tracker.toDate = system.date.today();
        tracker.selectedCommission = 'Processed Commissions';
        tracker.processTrackerWhenSearch();
        tracker.selectProcessedCommissionRecords();
        tracker.changeFilter();
        tracker.selectAllForProcessedCommission = true;
        tracker.selectProcessedCommissionRecords();
        tracker.assignDateToCommissionProcessed();
        tracker.findPartyProvider();
        tracker.isCommissionProcessed = true;
        system.debug('Email List:'+tracker.partyProviderEmailList);
        for(CommissionTrackerController.EmailToPartyProvider item:tracker.partyProviderEmailList)
        {
            item.isChecked = true;
        }
        tracker.sendEmailToProviders();
        tracker.selectedCommission = 'Paid Commissions';
        tracker.processTrackerWhenSearch();
        tracker.changeFilter();
        tracker.sendEmailToProviders();
        for(CommissionTrackerController.EmailToPartyProvider item:tracker.partyProviderEmailList)
        {
            item.isChecked = true;
        }
        tracker.sendEmailToProviders();
        test.stopTest();
    }
    
    private static testmethod void commissionTrackerExportTest()
    {
        string account_recordtype_id = Schema.SObjectType.Account.getRecordTypeInfosByName().get('Residential - Customer').getRecordTypeId();
        Account acc = TestDataFactory.createAccount('Harbor Energy',account_recordtype_id);
        acc.Channel_Partner_Status__c = 'Active';
        insert acc;
        Account acc2 = TestDataFactory.createAccount('360 Total Solutions LLC',account_recordtype_id);
        acc2.Channel_Partner_Status__c = 'Active';
        insert acc2;
        Contact cont = TestDataFactory.createContact('Test','O1', acc.id);
        cont.Title = 'Leadership';
        cont.email = 'test1@gmai.com';
        insert cont;
        Contact con2 = TestDataFactory.createContact('Test','O2', acc.id);
        con2.Title = 'Leadership';
        con2.email = 'test2@gmai.com';
        insert con2;
        Contact cont3 = TestDataFactory.createContact('Test','O3', acc2.id);
        cont3.Title = 'Leadership';
        cont3.email = 'test3@gmai.com';
        insert cont3;
        Contact con4 = TestDataFactory.createContact('Test','O4', acc2.id);
        con4.Title = 'Leadership';
        con4.email = 'test4@gmai.com';
        insert con4;
        List<Opportunity> opp_list = new List<Opportunity>();
        string opp_recordtype_id = Schema.SObjectType.Opportunity.getRecordTypeInfosByName().get('3rd Party - Design Sales').getRecordTypeId();
        Opportunity opp_1 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 1', acc.id, '17. Install Ready', 'Alabama');
        opp_1.LeadSource = '3rd Party Provider';
        opp_1.Lead_Source_Type__c = 'Channel';
        opp_1.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_1.Financing_Tool__c = 'Sunlight';
        opp_1.Loan_Term__c = '20';
        opp_1.Proposal_Created__c = true;
        opp_1.Engineering_Created__c = true;
        opp_1.Final_Design_Created_Date__c = system.Date.today();
        opp_1.Number_of_Arrays__c = 1;
        opp_1.Contract_Received_Confirmed__c= true;
        opp_1.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_1.Amount = 30000;
        opp_1.Number_of_Solar_Panels__c  = 25;
        opp_1.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_1.Panel_Wattage__c = 300;
        opp_1.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_1);
        /* -------------------------------------------------------*/
        Opportunity opp_2 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 2', acc.id, '7a. Contract Received Confirmed', 'Alabama');
        opp_2.LeadSource = '3rd Party Provider';
        opp_2.Lead_Source_Type__c = 'Channel';
        opp_2.Financing_Tool__c = 'Sunlight';
        opp_2.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_2.Loan_Term__c = '20';
        opp_2.Proposal_Created__c = true;
        opp_2.Engineering_Created__c = true;
        opp_2.Final_Design_Created_Date__c = system.Date.today();
        opp_2.Number_of_Arrays__c = 1;
        opp_2.Contract_Received_Confirmed__c= true;
        opp_2.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_2.Amount = 30000;
        opp_2.Number_of_Solar_Panels__c  = 25;
        opp_2.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_2.Panel_Wattage__c = 300;
        opp_2.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_2);
        /*--------------------------------------- */
        Opportunity opp_3 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 3', acc.id, '22. PTO', 'Alabama');
        opp_3.LeadSource = '3rd Party Provider';
        opp_3.Lead_Source_Type__c = 'Channel';
        opp_3.Financing_Tool__c = 'Sunlight';
        opp_3.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_2.Loan_Term__c = '20';
        opp_3.Proposal_Created__c = true;
        opp_3.Engineering_Created__c = true;
        opp_3.Final_Design_Created_Date__c = system.Date.today();
        opp_3.Number_of_Arrays__c = 1;
        opp_3.Contract_Received_Confirmed__c= true;
        opp_3.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_3.Amount = 30000;
        opp_3.Number_of_Solar_Panels__c  = 25;
        opp_3.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_3.Panel_Wattage__c = 300;
        opp_3.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_3);
        /*--------------------------------------------------*/
        Opportunity opp_4 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 3', acc.id, 'Cancelled', 'Alabama');
        opp_4.Reason_for_loss__c = 'Cancelled with Finance Partner';
        opp_4.LeadSource = '3rd Party Provider';
        opp_4.Lead_Source_Type__c = 'Channel';
        opp_4.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_4.Financing_Tool__c = 'Sunlight';
        opp_4.Loan_Term__c = '20';
        opp_4.Proposal_Created__c = true;
        opp_4.Engineering_Created__c = true;
        opp_4.Final_Design_Created_Date__c = system.Date.today();
        opp_4.Number_of_Arrays__c = 1;
        opp_4.Contract_Received_Confirmed__c= true;
        opp_4.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_4.Amount = 30000;
        opp_4.Number_of_Solar_Panels__c  = 25;
        opp_4.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_4.Panel_Wattage__c = 300;
        opp_4.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_4);
        /*--------------------------------------------*/
        Opportunity opp_5 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 1', acc.id, '17. Install Ready', 'Alabama');
        opp_5.LeadSource = '3rd Party Provider';
        opp_5.Lead_Source_Type__c = 'Channel';
        opp_5.X3rd_Party_Partner__c = 'Harbor Energy';
        opp_5.Financing_Tool__c = 'Sunlight';
        opp_5.Loan_Term__c = '20';
        opp_5.Proposal_Created__c = true;
        opp_5.Engineering_Created__c = true;
        opp_5.Final_Design_Created_Date__c = system.Date.today();
        opp_5.Number_of_Arrays__c = 1;
        opp_5.Contract_Received_Confirmed__c= true;
        opp_5.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_5.Amount = 30000;
        opp_5.Number_of_Solar_Panels__c  = 25;
        opp_5.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_5.Panel_Wattage__c = 300;
        opp_5.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_5);
        /*--------------------------------------------------------------*/
        Opportunity opp_6 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 1', acc.id, '17. Install Ready', 'Alabama');
        opp_6.LeadSource = '3rd Party Provider';
        opp_6.Lead_Source_Type__c = 'Channel';
        opp_6.X3rd_Party_Partner__c = '360 Total Solutions LLC';
        opp_6.Financing_Tool__c = 'Sunlight';
        opp_6.Loan_Term__c = '20';
        opp_6.Proposal_Created__c = true;
        opp_6.Engineering_Created__c = true;
        opp_6.Final_Design_Created_Date__c = system.Date.today();
        opp_6.Number_of_Arrays__c = 1;
        opp_6.Contract_Received_Confirmed__c= true;
        opp_6.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_6.Amount = 30000;
        opp_6.Number_of_Solar_Panels__c  = 25;
        opp_6.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_6.Panel_Wattage__c = 300;
        opp_6.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_6);
        /*--------------------------------------------------------------*/
        Opportunity opp_7 = TestDataFactory.createOpportunity(opp_recordtype_id, 'Test 1', acc.id, '17. Install Ready', 'Alabama');
        opp_7.LeadSource = '3rd Party Provider';
        opp_7.Lead_Source_Type__c = 'Channel';
        opp_7.X3rd_Party_Partner__c = '360 Total Solutions LLC';
        opp_7.Financing_Tool__c = 'Sunlight';
        opp_7.Loan_Term__c = '20';
        opp_7.Proposal_Created__c = true;
        opp_7.Engineering_Created__c = true;
        opp_7.Final_Design_Created_Date__c = system.Date.today();
        opp_7.Number_of_Arrays__c = 1;
        opp_7.Contract_Received_Confirmed__c= true;
        opp_7.Contract_Received_Confirmed_Date__c = system.Date.today().addDays(-5);
        opp_7.Amount = 30000;
        opp_7.Number_of_Solar_Panels__c  = 25;
        opp_7.Panel_Type__c = 'Q.PEAK-G4.1 300';
        opp_7.Panel_Wattage__c = 300;
        opp_7.Installation_Complete_Date__c = Date.today();
        opp_list.add(opp_7);
        insert opp_list;
        /*----------------------------------------------------*/
        
        Commission_plan__c commission_plan_1 = TestDataFactory.createCommissionPlan('CP Alabama');
        commission_plan_1.Location__c = 'Alabama';
        commission_plan_1.User__c = UserInfo.getUserId();
        commission_plan_1.Channel_Partner_Account__c = acc.id;
        commission_plan_1.X3rd_Party_Partner__c = 'Harbor Energy';
        commission_plan_1.Base_6kW__c = 2500;
        commission_plan_1.X6kW__c = 2500;
        commission_plan_1.Milestone_1_Percent__c = 30;
        commission_plan_1.Milestone_2_Percent__c = 55;
        commission_plan_1.Milestone_3_Percent__c = 15;
        insert commission_plan_1;
        Commission__c commission_1 = new Commission__c();
        commission_1.Opportunity__c = opp_1.id;
        commission_1.Commission_Plan__c = commission_plan_1.id;
        commission_1.Milestone_1_Processed_Date__c = system.date.Today();
        commission_1.Milestone_1_Processed__c = true;
        insert commission_1;
        /*------------------------------------------ */
        Commission__c commission_2 = new Commission__c();
        commission_2.Opportunity__c = opp_2.id;
        commission_2.Commission_Plan__c = commission_plan_1.id;
        commission_2.Milestone_1_Processed_Date__c = system.date.Today();
        commission_2.Milestone_1_Processed__c = true;
        insert commission_2;
        /*------------------------------------------ */
        Commission__c commission_3 = new Commission__c();
        commission_3.Opportunity__c = opp_3.id;
        commission_3.Milestone_2_Processed_Date__c = system.date.Today();
        commission_3.Milestone_2_Processed__c = true;
        commission_3.Commission_Plan__c = commission_plan_1.id;
        insert commission_3;
        /*------------------------------------------ */
        Commission__c commission_4 = new Commission__c();
        commission_4.Opportunity__c = opp_4.id;
        commission_4.Commission_Plan__c = commission_plan_1.id;
        commission_4.Milestone_3_Processed_Date__c = system.date.Today();
        commission_4.Milestone_3_Processed__c = true;
        insert commission_4;
        /*------------------------------------------ */
        Commission__c commission_5 = new Commission__c();
        commission_5.Opportunity__c = opp_5.id;
        commission_5.Commission_Plan__c = commission_plan_1.id;
        commission_5.M1_Clawback_Processed_Date__c = system.date.Today();
        commission_5.M1_Clawback_Complete__c = true;
        insert commission_5;
        /*------------------------------------------ */
        Commission__c commission_6 = new Commission__c();
        commission_6.Opportunity__c = opp_6.id;
        commission_6.Commission_Plan__c = commission_plan_1.id;
        commission_6.Milestone_1_Processed_Date__c = system.date.Today();
        commission_6.Milestone_1_Processed__c = true;
        insert commission_6;
        /*------------------------------------------ */
        Commission__c commission_7 = new Commission__c();
        commission_7.Opportunity__c = opp_3.id;
        commission_7.Commission_Plan__c = commission_plan_1.id;
        commission_7.Milestone_2_Processed_Date__c = system.date.Today();
        commission_7.Milestone_2_Processed__c = true;
        insert commission_7;
        /*------------------------------------------ */
        Commission__c commission_8 = new Commission__c();
        commission_8.Opportunity__c = opp_7.id;
        commission_8.Milestone_2_Processed_Date__c = system.date.Today();
        commission_8.Milestone_2_Processed__c = true;
        insert commission_8;
        /*------------------------------------------ */
        Commission__c commission_9 = new Commission__c();
        commission_9.Opportunity__c = opp_3.id;
        commission_9.Commission_Plan__c = commission_plan_1.id;
        commission_9.Milestone_3_Processed_Date__c = system.date.Today();
        commission_9.Milestone_3_Processed__c = true;
        insert commission_9;
         /*------------------------------------------ */
        Commission__c commission_10 = new Commission__c();
        commission_10.Opportunity__c = opp_7.id;
        commission_10.Milestone_3_Processed_Date__c = system.date.Today();
        commission_10.Milestone_3_Processed__c = true;
        insert commission_10;
        /*------------------------------------------ */
        Commission__c commission_11 = new Commission__c();
        commission_11.Opportunity__c = opp_3.id;
        commission_11.Commission_Plan__c = commission_plan_1.id;
        commission_11.M1_Clawback_Processed_Date__c = system.date.Today();
        commission_11.M1_Clawback_Complete__c = true;
        insert commission_11;
         /*------------------------------------------ */
        Commission__c commission_12 = new Commission__c();
        commission_12.Opportunity__c = opp_7.id;
        commission_12.M1_Clawback_Processed_Date__c = system.date.Today();
        commission_12.M1_Clawback_Complete__c = true;
        insert commission_12;
        test.startTest();
        CommissionTrackerController tracker = new CommissionTrackerController();
        tracker.fromDate = system.date.today();
        tracker.toDate = system.date.today();
        tracker.selectedCommission = 'Processed Commissions';
        PageReference pf = new PageReference('/apex/CommissionTrackerExport');
        Test.setCurrentPage(pf);
        string selected_milestone = string.join(tracker.selectedAllMilestone,';');
        string selected_3rd_party_provider = tracker.setToDelimitedString(',',tracker.selectedAll3rdPartyProvider,true);
        pf.getParameters().put('startdate', EncodingUtil.urlEncode(tracker.toDate.format(),'UTF-8'));
        pf.getParameters().put('enddate', EncodingUtil.urlEncode(tracker.toDate.format(),'UTF-8'));
        pf.getParameters().put('reporttype',string.valueOf(2));
        pf.getParameters().put('milestone', EncodingUtil.urlEncode(selected_milestone,'UTF-8'));
        pf.getParameters().put('partprovider', EncodingUtil.urlEncode(selected_3rd_party_provider,'UTF-8'));
        pf.getParameters().put('paidmilestone', string.valueof(true));
        CommissionTrackerExportController tracker_export = new CommissionTrackerExportController();
        string data = tracker_export.getCsvString();
        //for paid commmission
        tracker.processTrackerWhenSearch();
        tracker.selectAllForProcessedCommission = true;
        tracker.selectProcessedCommissionRecords();
        tracker.assignDateToCommissionProcessed();
        pf.getParameters().put('reporttype',string.valueOf(3));
        tracker_export = new CommissionTrackerExportController();
        data = tracker_export.getCsvString();
        /*-----------------------*/
        string soql = CommissionTrackerUtility.commissionProcessedSOQL('M1', '\'Harbor Energy\'', system.date.today(), system.date.today(),false);
        soql = CommissionTrackerUtility.commissionProcessedSOQL('M2', '\'Harbor Energy\'', system.date.today(), system.date.today(),false);
        soql = CommissionTrackerUtility.commissionProcessedSOQL('M3', '\'Harbor Energy\'', system.date.today(), system.date.today(),false);
        soql = CommissionTrackerUtility.commissionProcessedSOQL('Clawbacks', '\'Harbor Energy\'', system.date.today(), system.date.today(),false);
        soql = CommissionTrackerUtility.commissionProcessedSOQL('', '\'Harbor Energy\'', system.date.today(), system.date.today(),false);
        
        soql = CommissionTrackerUtility.commissionPaidSOQL('M1', '\'Harbor Energy\'', system.date.today(), system.date.today());
        soql = CommissionTrackerUtility.commissionPaidSOQL('M2', '\'Harbor Energy\'', system.date.today(), system.date.today());
        soql = CommissionTrackerUtility.commissionPaidSOQL('M3', '\'Harbor Energy\'', system.date.today(), system.date.today());
        soql = CommissionTrackerUtility.commissionPaidSOQL('Clawbacks', '\'Harbor Energy\'', system.date.today(), system.date.today());
        soql = CommissionTrackerUtility.commissionPaidSOQL('', '\'Harbor Energy\'', system.date.today(), system.date.today());
        test.stopTest();
    }
}